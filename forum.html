<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–ú—É–ª—å—Ç–∏-–ü—Ä–æ—Ñ–∏–ª–∏</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f3f3f3;
      display: flex;
      justify-content: center;
      padding: 30px;
    }
    .container {
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      width: 350px;
    }
    input, textarea, button, select {
      width: 100%;
      padding: 10px;
      margin: 8px 0;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    button {
      background-color: #007bff;
      color: white;
      font-weight: bold;
      cursor: pointer;
    }
    button:hover {
      background-color: #0056b3;
    }
    .avatar {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      background: #ddd;
      object-fit: cover;
      display: block;
      margin: 10px auto;
    }
    .status {
      font-size: 0.9em;
      color: green;
      text-align: center;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>–ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h2>

    <select id="profileList" onchange="loadSelectedProfile()">
      <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ—Ñ–∏–ª—å</option>
    </select>

    <input type="text" id="name" placeholder="–ò–º—è (ID –ø—Ä–æ—Ñ–∏–ª—è)" />
    <input type="email" id="email" placeholder="Email" />
    <input type="password" id="password" placeholder="–ü–∞—Ä–æ–ª—å" />
    <textarea id="about" placeholder="–û —Å–µ–±–µ" rows="3"></textarea>
    <input type="file" id="photoInput" accept="image/*" />
    <img src="" id="avatar" class="avatar" alt="–§–æ—Ç–æ –ø—Ä–æ—Ñ–∏–ª—è" />

    <button onclick="saveProfile()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    <button onclick="handleLogin()">üîê –í–æ–π—Ç–∏</button>

    <div class="status" id="status"></div>
  </div>

  <script>
    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ –ø—Ä–æ—Ñ–∏–ª–µ–π
    function loadProfileList() {
      const select = document.getElementById('profileList');
      const profiles = JSON.parse(localStorage.getItem('profiles') || '{}');
      select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ—Ñ–∏–ª—å</option>';
      Object.keys(profiles).forEach(key => {
        const opt = document.createElement('option');
        opt.value = key;
        opt.textContent = key;
        select.appendChild(opt);
      });
    }

    // –ó–∞–≥—Ä—É–∂–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å
    function loadSelectedProfile() {
      const selected = document.getElementById('profileList').value;
      if (!selected) return;

      const profiles = JSON.parse(localStorage.getItem('profiles') || '{}');
      const profile = profiles[selected];
      if (profile) {
        document.getElementById('name').value = profile.name;
        document.getElementById('email').value = profile.email;
        document.getElementById('about').value = profile.about;
        document.getElementById('avatar').src = profile.photo || '';
        document.getElementById('password').value = ''; // –ü–∞—Ä–æ–ª—å –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
      }
    }

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–æ—Ñ–∏–ª—å
    function saveProfile() {
      const name = document.getElementById('name').value.trim();
      const email = document.getElementById('email').value.trim();
      const about = document.getElementById('about').value.trim();
      const photoInput = document.getElementById('photoInput');
      const avatar = document.getElementById('avatar');

      if (!name || !email) {
        alert('–ò–º—è –∏ Email –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã!');
        return;
      }

      let profiles = JSON.parse(localStorage.getItem('profiles') || '{}');
      let profile = { name, email, about };

      // –ï—Å–ª–∏ –∑–∞–≥—Ä—É–∂–µ–Ω–æ —Ñ–æ—Ç–æ ‚Äî —á–∏—Ç–∞–µ–º –∫–∞–∫ base64
      if (photoInput.files.length > 0) {
        const reader = new FileReader();
        reader.onload = () => {
          profile.photo = reader.result;
          profiles[name] = profile;
          localStorage.setItem('profiles', JSON.stringify(profiles));
          document.getElementById('status').textContent = '‚úÖ –ü—Ä–æ—Ñ–∏–ª—å —Å–æ—Ö—Ä–∞–Ω—ë–Ω!';
          loadProfileList();
          avatar.src = reader.result;
        };
        reader.readAsDataURL(photoInput.files[0]);
      } else {
        profile.photo = avatar.src;
        profiles[name] = profile;
        localStorage.setItem('profiles', JSON.stringify(profiles));
        document.getElementById('status').textContent = '‚úÖ –ü—Ä–æ—Ñ–∏–ª—å —Å–æ—Ö—Ä–∞–Ω—ë–Ω!';
        loadProfileList();
      }
    }

    // –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É
    function handleLogin() {
      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value.trim();

      if (!email || !password) {
        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ Email –∏ –ø–∞—Ä–æ–ª—å');
        return;
      }

      let users = JSON.parse(localStorage.getItem('users') || '[]');
      if (users.length === 0) {
        users = [
          { name: 'Meirman', email: 'kuanyshbekmeir@gmail.com', password: 'admin123', role: 'Admin' },
          { name: 'User1', email: 'user1@test.com', password: 'user123', role: 'User' }
        ];
        localStorage.setItem('users', JSON.stringify(users));
      }

      const user = users.find(u => u.email === email && u.password === password);
      if (!user) {
        alert('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π email –∏–ª–∏ –ø–∞—Ä–æ–ª—å');
        return;
      }

      localStorage.setItem('currentUser', JSON.stringify(user));
      if (user.role === 'Admin') {
        window.location.href = 'admin.html';
      } else {
        alert('‚úÖ –í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω, –Ω–æ –¥–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∞');
      }
    }

    // –ê–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
    document.addEventListener('DOMContentLoaded', () => {
      loadProfileList();
    });
  </script>
</body>
</html>
